---
title: "Демонстрация пакетов readr и tydyr"
output:
  html_document:
    df_print: paged
---

Этот документ и связанные файлы на [github](https://github.com/bivni/tidy_demo)


> Encoding: UTF-8  (File->Open with enconding)

Решается задача импорта и приведения данных в форму пригодной для анализа "tidy data"

Используем пакеты из набора `tidyverse`:

* readr
* tydyr
* dplyr

### Сценарий 

В файле `world_population.csv` в текстовой форме с разделителями "," находятся данные о населелении стран мира.  

Данные в файле размещены в "широком формате", напоминающем сводную таблицу. Номера годов образуют заголовки столбцо, названия - заголовки строк, а в пересечении -- численность населения страны в токой-то год.

Требуется представить данные в более организованной, более похожей на таблицы в реляционной базе данных, форме.



```{r setup}

library(tidyverse)
```



## Скачивание и импорт данных 


```{r download}
download.file("https://github.com/bivni/tidy_demo/raw/master/world_population.csv",
              destfile = "world_population.csv")

```

импортируем 

```{r import}
world_population <- readr::read_csv(file="world_population.csv", na="-")
```



```{r}
print(world_population,n=14)
```

Какие проблемы импорта? В каких строках 


```{r problems}
problems(world_population)
```







## Используем tidyr


```{r gather}
long_world_population <- tidyr::gather(world_population,year, population,
                                       -c(COUNTRY,COUNTRY_CODE,INDICATOR_NAME,
                                          INDICATOR_CODE))
```



```{r}
head(long_world_population,20)
```


Удалим столбцы


```{r remove_columns}
clean_world_population <-  long_world_population %>% 
          select( -starts_with("INDICATOR")) 
print(clean_world_population)
```


